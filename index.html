<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Планировщик задач</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #707579;
            --tg-theme-link-color: #3390ec;
            --tg-theme-button-color: #3390ec;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f4f4f5;
        }
        .dark {
            --tg-theme-bg-color: #1c1c1d;
            --tg-theme-text-color: #ffffff;
            --tg-theme-hint-color: #aaaaaa;
            --tg-theme-link-color: #5d9ce6;
            --tg-theme-button-color: #5d9ce6;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #2c2c2e;
        }
        body{
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            transition: background-color .3s, color .3s;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .task-card{ transition: transform .2s, box-shadow .2s; }
        .task-card:hover{ transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,.1); }

        .priority-low{ background-color: rgba(52,211,153,.1); color: rgb(16,185,129); }
        .priority-medium{ background-color: rgba(96,165,250,.1); color: rgb(59,130,246); }
        .priority-high{ background-color: rgba(251,191,36,.1); color: rgb(234,179,8); }
        .priority-critical{ background-color: rgba(239,68,68,.1); color: rgb(239,68,68); }

        .status-backlog{ background-color: rgba(156,163,175,.1); color: rgb(156,163,175); }
        .status-in-progress{ background-color: rgba(59,130,246,.1); color: rgb(59,130,246); }
        .status-review{ background-color: rgba(168,85,247,.1); color: rgb(168,85,247); }
        .status-done{ background-color: rgba(16,185,129,.1); color: rgb(16,185,129); }

        .kanban-column{ min-height: 60vh; }
        .calendar-day{ min-height: 100px; }
        .calendar-day.today{ background-color: rgba(59,130,246,.1); }
        .calendar-day:hover{ background-color: rgba(59,130,246,.05); }

        .subtask-checkbox:checked + .subtask-label{
            text-decoration: line-through;
            color: var(--tg-theme-hint-color);
        }

        .command-palette{ backdrop-filter: blur(10px); }

        @media (max-width: 640px){
            .kanban-column{
                min-height: auto;
                max-height: 60vh;
                overflow-y: auto;
            }
        }
    </style>
</head>
<body class="min-h-screen">
<div id="app" class="flex flex-col min-h-screen">
    <!-- Header -->
    <header class="sticky top-0 z-10 bg-[var(--tg-theme-bg-color)] border-b border-[var(--tg-theme-secondary-bg-color)]">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <button id="menu-button" class="p-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="text-xl font-semibold">Планировщик задач</h1>
            </div>
            <div class="flex items-center space-x-2">
                <button id="search-button" class="p-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]">
                    <i class="fas fa-search"></i>
                </button>
                <button id="add-task-button" class="p-2 rounded-full bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)]">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main -->
    <main class="flex-1 container mx-auto px-4 py-4">
        <!-- View Selector -->
        <div class="flex justify-center mb-6">
            <div class="inline-flex rounded-md shadow-sm" role="group">
                <button data-view="list" class="view-selector px-4 py-2 text-sm font-medium rounded-l-lg border border-[var(--tg-theme-secondary-bg-color)] hover:bg-[var(--tg-theme-secondary-bg-color)]">
                    <i class="fas fa-list mr-2"></i> Список
                </button>
                <button data-view="kanban" class="view-selector px-4 py-2 text-sm font-medium border-t border-b border-[var(--tg-theme-secondary-bg-color)] hover:bg-[var(--tg-theme-secondary-bg-color)]">
                    <i class="fas fa-columns mr-2"></i> Доска
                </button>
                <button data-view="calendar" class="view-selector px-4 py-2 text-sm font-medium rounded-r-lg border border-[var(--tg-theme-secondary-bg-color)] hover:bg-[var(--tg-theme-secondary-bg-color)]">
                    <i class="fas fa-calendar-alt mr-2"></i> Календарь
                </button>
            </div>
        </div>

        <!-- Project Selector -->
        <div class="mb-4 flex items-center">
            <select id="project-selector" class="bg-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-text-color)] rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]">
                <option value="all">Все проекты</option>
                <option value="work">Работа</option>
                <option value="personal">Личное</option>
                <option value="team">Команда</option>
            </select>
            <button id="add-project-button" class="ml-2 p-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <!-- List View -->
        <div id="list-view" class="view-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold">Задачи</h2>
                <div class="flex space-x-2">
                    <button id="filter-button" class="px-3 py-1 text-sm rounded-lg border border-[var(--tg-theme-secondary-bg-color)] hover:bg-[var(--tg-theme-secondary-bg-color)]">
                        <i class="fas fa-filter mr-1"></i> Фильтр
                    </button>
                    <button id="sort-button" class="px-3 py-1 text-sm rounded-lg border border-[var(--tg-theme-secondary-bg-color)] hover:bg-[var(--tg-theme-secondary-bg-color)]">
                        <i class="fas fa-sort mr-1"></i> Сортировка
                    </button>
                </div>
            </div>

            <div class="space-y-3">
                <!-- Task Item -->
                <div class="task-card bg-[var(--tg-theme-secondary-bg-color)] rounded-lg p-4 cursor-pointer">
                    <div class="flex items-start justify-between">
                        <div class="flex items-start space-x-3">
                            <div class="mt-1">
                                <input type="checkbox" class="rounded border-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-button-color)] focus:ring-[var(--tg-theme-button-color)]">
                            </div>
                            <div>
                                <h3 class="font-medium">Подготовить проектное предложение</h3>
                                <p class="text-sm text-[var(--tg-theme-hint-color)] mt-1">Срок: завтра, 15:00</p>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <span class="priority-high text-xs px-2 py-1 rounded-full">Высокий</span>
                                    <span class="status-in-progress text-xs px-2 py-1 rounded-full">В работе</span>
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Работа</span>
                                </div>
                            </div>
                        </div>
                        <button class="text-[var(--tg-theme-hint-color)] hover:text-[var(--tg-theme-text-color)]">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>

                <!-- Task Item -->
                <div class="task-card bg-[var(--tg-theme-secondary-bg-color)] rounded-lg p-4 cursor-pointer">
                    <div class="flex items-start justify-between">
                        <div class="flex items-start space-x-3">
                            <div class="mt-1">
                                <input type="checkbox" class="rounded border-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-button-color)] focus:ring-[var(--tg-theme-button-color)]">
                            </div>
                            <div>
                                <h3 class="font-medium">Командная встреча</h3>
                                <p class="text-sm text-[var(--tg-theme-hint-color)] mt-1">Сегодня в 10:00</p>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <span class="priority-medium text-xs px-2 py-1 rounded-full">Средний</span>
                                    <span class="status-backlog text-xs px-2 py-1 rounded-full">Бэклог</span>
                                    <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">Команда</span>
                                </div>
                            </div>
                        </div>
                        <button class="text-[var(--tg-theme-hint-color)] hover:text-[var(--tg-theme-text-color)]">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>

                <!-- Task Item -->
                <div class="task-card bg-[var(--tg-theme-secondary-bg-color)] rounded-lg p-4 cursor-pointer">
                    <div class="flex items-start justify-between">
                        <div class="flex items-start space-x-3">
                            <div class="mt-1">
                                <input type="checkbox" class="rounded border-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-button-color)] focus:ring-[var(--tg-theme-button-color)]">
                            </div>
                            <div>
                                <h3 class="font-medium">Купить продукты</h3>
                                <p class="text-sm text-[var(--tg-theme-hint-color)] mt-1">Без срока</p>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <span class="priority-low text-xs px-2 py-1 rounded-full">Низкий</span>
                                    <span class="status-backlog text-xs px-2 py-1 rounded-full">Бэклог</span>
                                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Личное</span>
                                </div>
                            </div>
                        </div>
                        <button class="text-[var(--tg-theme-hint-color)] hover:text-[var(--tg-theme-text-color)]">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kanban View -->
        <div id="kanban-view" class="view-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Backlog -->
                <div class="kanban-column bg-[var(--tg-theme-secondary-bg-color)] rounded-lg p-3">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium">Бэклог</h3>
                        <span class="text-xs bg-gray-200 text-gray-800 rounded-full px-2 py-1">3</span>
                    </div>
                    <div class="space-y-3">
                        <div class="task-card bg-[var(--tg-theme-bg-color)] rounded-lg p-3 cursor-move">
                            <h4 class="font-medium">Исследовать конкурентов</h4>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="priority-medium text-xs px-2 py-1 rounded-full">Средний</span>
                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Работа</span>
                            </div>
                        </div>
                        <div class="task-card bg-[var(--tg-theme-bg-color)] rounded-lg p-3 cursor-move">
                            <h4 class="font-medium">Обновить портфолио</h4>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="priority-low text-xs px-2 py-1 rounded-full">Низкий</span>
                                <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">Команда</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- In Progress -->
                <div class="kanban-column bg-[var(--tg-theme-secondary-bg-color)] rounded-lg p-3">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium">В работе</h3>
                        <span class="text-xs bg-blue-200 text-blue-800 rounded-full px-2 py-1">2</span>
                    </div>
                    <div class="space-y-3">
                        <div class="task-card bg-[var(--tg-theme-bg-color)] rounded-lg p-3 cursor-move">
                            <h4 class="font-medium">Подготовить проектное предложение</h4>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="priority-high text-xs px-2 py-1 rounded-full">Высокий</span>
                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Работа</span>
                            </div>
                        </div>
                        <div class="task-card bg-[var(--tg-theme-bg-color)] rounded-lg p-3 cursor-move">
                            <h4 class="font-medium">Дизайн нового логотипа</h4>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="priority-medium text-xs px-2 py-1 rounded-full">Средний</span>
                                <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">Команда</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Review -->
                <div class="kanban-column bg-[var(--tg-theme-secondary-bg-color)] rounded-lg p-3">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium">На проверке</h3>
                        <span class="text-xs bg-purple-200 text-purple-800 rounded-full px-2 py-1">1</span>
                    </div>
                    <div class="space-y-3">
                        <div class="task-card bg-[var(--tg-theme-bg-color)] rounded-lg p-3 cursor-move">
                            <h4 class="font-medium">Ревью PR #42</h4>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="priority-critical text-xs px-2 py-1 rounded-full">Критичный</span>
                                <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">Команда</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Done -->
                <div class="kanban-column bg-[var(--tg-theme-secondary-bg-color)] rounded-lg p-3">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-medium">Готово</h3>
                        <span class="text-xs bg-green-200 text-green-800 rounded-full px-2 py-1">2</span>
                    </div>
                    <div class="space-y-3">
                        <div class="task-card bg-[var(--tg-theme-bg-color)] rounded-lg p-3 cursor-move opacity-70">
                            <h4 class="font-medium line-through">Настроить CI/CD</h4>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="priority-high text-xs px-2 py-1 rounded-full">Высокий</span>
                                <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">Команда</span>
                            </div>
                        </div>
                        <div class="task-card bg-[var(--tg-theme-bg-color)] rounded-lg p-3 cursor-move opacity-70">
                            <h4 class="font-medium line-through">Написать документацию</h4>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span class="priority-medium text-xs px-2 py-1 rounded-full">Средний</span>
                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Работа</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendar-view" class="view-content hidden">
            <div class="mb-4 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <button id="prev-month" class="p-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h2 class="text-lg font-semibold" id="calendar-title">Июнь 2023</h2>
                    <button id="next-month" class="p-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div>
                    <button id="today-button" class="px-3 py-1 text-sm rounded-lg border border-[var(--tg-theme-secondary-bg-color)] hover:bg-[var(--tg-theme-secondary-bg-color)]">
                        Сегодня
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-7 gap-1 mb-1">
                <div class="text-center text-sm font-medium py-2">Вс</div>
                <div class="text-center text-sm font-medium py-2">Пн</div>
                <div class="text-center text-sm font-medium py-2">Вт</div>
                <div class="text-center text-sm font-medium py-2">Ср</div>
                <div class="text-center text-sm font-medium py-2">Чт</div>
                <div class="text-center text-sm font-medium py-2">Пт</div>
                <div class="text-center text-sm font-medium py-2">Сб</div>
            </div>

            <div class="grid grid-cols-7 gap-1">
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">28</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">29</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">30</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">31</div></div>

                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">1</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">2</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">3</div></div>

                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">4</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">5</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1">
                    <div class="text-right text-sm mb-1">6</div>
                    <div class="text-xs truncate px-1 py-0.5 bg-blue-100 text-blue-800 rounded mb-1">Командная встреча</div>
                </div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">7</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">8</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">9</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">10</div></div>

                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">11</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">12</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">13</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">14</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">15</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">16</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">17</div></div>

                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">18</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">19</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">20</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">21</div></div>
                <div class="calendar-day today border border-[var(--tg-theme-secondary-bg-color)] rounded p-1">
                    <div class="text-right text-sm mb-1 font-bold">22</div>
                    <div class="text-xs truncate px-1 py-0.5 bg-red-100 text-red-800 rounded mb-1">Дедлайн по проекту</div>
                    <div class="text-xs truncate px-1 py-0.5 bg-green-100 text-green-800 rounded mb-1">Купить продукты</div>
                </div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">23</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">24</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">25</div></div>

                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">26</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">27</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">28</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">29</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">30</div></div>
                <div class="calendar-day border border-[var(--tg-theme-secondary-bg-color)] rounded p-1"><div class="text-right text-sm mb-1">1</div></div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="md:hidden sticky bottom-0 bg-[var(--tg-theme-bg-color)] border-t border-[var(--tg-theme-secondary-bg-color)]">
        <div class="flex justify-around py-2">
            <button data-view="list" class="view-selector p-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]" aria-label="Список"><i class="fas fa-list text-lg"></i></button>
            <button data-view="kanban" class="view-selector p-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]" aria-label="Доска"><i class="fas fa-columns text-lg"></i></button>
            <button data-view="calendar" class="view-selector p-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]" aria-label="Календарь"><i class="fas fa-calendar-alt text-lg"></i></button>
            <button id="mobile-add-task-button" class="p-2 rounded-full bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)]" aria-label="Добавить задачу"><i class="fas fa-plus text-lg"></i></button>
        </div>
    </nav>

    <!-- Task Modal -->
    <div id="task-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-[var(--tg-theme-bg-color)] rounded-t-3xl shadow-xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-[var(--tg-theme-bg-color)] p-4 flex justify-between items-center border-b border-[var(--tg-theme-secondary-bg-color)]">
                <h2 class="text-xl font-semibold">Новая задача</h2>
                <button id="close-task-modal" class="p-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <input type="text" id="task-title" placeholder="Название задачи" class="w-full px-4 py-3 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]">
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm text-[var(--tg-theme-hint-color)] mb-1">Приоритет</label>
                        <select id="task-priority" class="w-full px-4 py-2 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]">
                            <option value="low">Низкий</option>
                            <option value="medium" selected>Средний</option>
                            <option value="high">Высокий</option>
                            <option value="critical">Критичный</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-[var(--tg-theme-hint-color)] mb-1">Статус</label>
                        <select id="task-status" class="w-full px-4 py-2 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]">
                            <option value="backlog">Бэклог</option>
                            <option value="in-progress">В работе</option>
                            <option value="review">На проверке</option>
                            <option value="done">Готово</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm text-[var(--tg-theme-hint-color)] mb-1">Проект</label>
                        <select id="task-project" class="w-full px-4 py-2 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]">
                            <option value="work">Работа</option>
                            <option value="personal">Личное</option>
                            <option value="team">Команда</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-[var(--tg-theme-hint-color)] mb-1">Дата завершения</label>
                        <input type="date" id="task-due-date" class="w-full px-4 py-2 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]">
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm text-[var(--tg-theme-hint-color)] mb-1">Описание</label>
                    <textarea id="task-description" rows="3" placeholder="Добавьте детали..." class="w-full px-4 py-2 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]"></textarea>
                </div>

                <div class="mb-4">
                    <label class="block text-sm text-[var(--tg-theme-hint-color)] mb-1">Подзадачи</label>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="checkbox" id="subtask1" class="subtask-checkbox rounded border-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-button-color)] focus:ring-[var(--tg-theme-button-color)]">
                            <label for="subtask1" class="subtask-label ml-2">Изучить конкурентов</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="subtask2" class="subtask-checkbox rounded border-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-button-color)] focus:ring-[var(--tg-theme-button-color)]">
                            <label for="subtask2" class="subtask-label ml-2">Набросать структуру</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="subtask3" class="subtask-checkbox rounded border-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-button-color)] focus:ring-[var(--tg-theme-button-color)]">
                            <label for="subtask3" class="subtask-label ml-2">Написать черновик</label>
                        </div>
                    </div>
                    <button class="mt-2 text-sm text-[var(--tg-theme-link-color)] flex items-center">
                        <i class="fas fa-plus mr-1"></i> Добавить подзадачу
                    </button>
                </div>

                <div class="mb-4">
                    <label class="block text-sm text-[var(--tg-theme-hint-color)] mb-1">Метки</label>
                    <div class="flex flex-wrap gap-2">
                        <span class="inline-flex items-center bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                            Работа
                            <button class="ml-1 text-blue-500 hover:text-blue-700">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </span>
                        <span class="inline-flex items-center bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">
                            Важно
                            <button class="ml-1 text-green-500 hover:text-green-700">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </span>
                        <button class="text-sm text-[var(--tg-theme-link-color)] flex items-center">
                            <i class="fas fa-plus mr-1"></i> Добавить метку
                        </button>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm text-[var(--tg-theme-hint-color)] mb-1">Напоминание</label>
                    <select id="task-reminder" class="w-full px-4 py-2 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]">
                        <option value="">Без напоминания</option>
                        <option value="5min">За 5 минут</option>
                        <option value="15min">За 15 минут</option>
                        <option value="30min">За 30 минут</option>
                        <option value="1hour">За 1 час</option>
                        <option value="1day">За 1 день</option>
                    </select>
                </div>

                <div class="flex justify-end space-x-2 mt-6">
                    <button id="cancel-task" class="px-4 py-2 rounded-lg border border-[var(--tg-theme-secondary-bg-color)] hover:bg-[var(--tg-theme-secondary-bg-color)]">Отмена</button>
                    <button id="save-task" class="px-4 py-2 rounded-lg bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)]">Сохранить</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div id="project-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-[var(--tg-theme-bg-color)] rounded-t-3xl shadow-xl max-h-[70vh] overflow-y-auto">
            <div class="sticky top-0 bg-[var(--tg-theme-bg-color)] p-4 flex justify-between items-center border-b border-[var(--tg-theme-secondary-bg-color)]">
                <h2 class="text-xl font-semibold">Новый проект</h2>
                <button id="close-project-modal" class="p-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <input type="text" id="project-name" placeholder="Название проекта" class="w-full px-4 py-3 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]">
                </div>

                <div class="mb-4">
                    <label class="block text-sm text-[var(--tg-theme-hint-color)] mb-1">Цвет</label>
                    <div class="flex space-x-2">
                        <button class="w-8 h-8 rounded-full bg-blue-500 border-2 border-blue-700"></button>
                        <button class="w-8 h-8 rounded-full bg-green-500 border-2 border-transparent"></button>
                        <button class="w-8 h-8 rounded-full bg-purple-500 border-2 border-transparent"></button>
                        <button class="w-8 h-8 rounded-full bg-red-500 border-2 border-transparent"></button>
                        <button class="w-8 h-8 rounded-full bg-yellow-500 border-2 border-transparent"></button>
                        <button class="w-8 h-8 rounded-full bg-pink-500 border-2 border-transparent"></button>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm text-[var(--tg-theme-hint-color)] mb-1">Описание</label>
                    <textarea id="project-description" rows="3" placeholder="Добавьте описание проекта..." class="w-full px-4 py-2 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]"></textarea>
                </div>

                <div class="flex justify-end space-x-2 mt-6">
                    <button id="cancel-project" class="px-4 py-2 rounded-lg border border-[var(--tg-theme-secondary-bg-color)] hover:bg-[var(--tg-theme-secondary-bg-color)]">Отмена</button>
                    <button id="save-project" class="px-4 py-2 rounded-lg bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)]">Сохранить</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Command Palette -->
    <div id="command-palette" class="fixed inset-0 z-50 hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative w-full max-w-md mx-4">
            <div class="command-palette bg-[var(--tg-theme-bg-color)] rounded-lg shadow-xl overflow-hidden">
                <div class="p-4 border-b border-[var(--tg-theme-secondary-bg-color)]">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-[var(--tg-theme-hint-color)]"></i>
                        </div>
                        <input type="text" id="command-input" placeholder="Введите команду или поиск..." class="w-full pl-10 pr-4 py-2 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--tg-theme-button-color)]">
                    </div>
                </div>
                <div class="max-h-96 overflow-y-auto">
                    <div class="px-4 py-2 text-sm text-[var(--tg-theme-hint-color)]">Задачи</div>
                    <div class="command-option px-4 py-3 hover:bg-[var(--tg-theme-secondary-bg-color)] cursor-pointer">
                        <div class="flex items-center">
                            <div class="p-2 rounded-full bg-blue-100 text-blue-800 mr-3"><i class="fas fa-plus"></i></div>
                            <div>
                                <div class="font-medium">Создать новую задачу</div>
                                <div class="text-xs text-[var(--tg-theme-hint-color)]">Добавьте новую задачу в список</div>
                            </div>
                        </div>
                    </div>
                    <div class="command-option px-4 py-3 hover:bg-[var(--tg-theme-secondary-bg-color)] cursor-pointer">
                        <div class="flex items-center">
                            <div class="p-2 rounded-full bg-purple-100 text-purple-800 mr-3"><i class="fas fa-search"></i></div>
                            <div>
                                <div class="font-medium">Искать задачи</div>
                                <div class="text-xs text-[var(--tg-theme-hint-color)]">Найдите задачи по названию или описанию</div>
                            </div>
                        </div>
                    </div>

                    <div class="px-4 py-2 text-sm text-[var(--tg-theme-hint-color)]">Проекты</div>
                    <div class="command-option px-4 py-3 hover:bg-[var(--tg-theme-secondary-bg-color)] cursor-pointer">
                        <div class="flex items-center">
                            <div class="p-2 rounded-full bg-green-100 text-green-800 mr-3"><i class="fas fa-folder-plus"></i></div>
                            <div>
                                <div class="font-medium">Создать новый проект</div>
                                <div class="text-xs text-[var(--tg-theme-hint-color)]">Организуйте задачи по проектам</div>
                            </div>
                        </div>
                    </div>

                    <div class="px-4 py-2 text-sm text-[var(--tg-theme-hint-color)]">Представления</div>
                    <div class="command-option px-4 py-3 hover:bg-[var(--tg-theme-secondary-bg-color)] cursor-pointer">
                        <div class="flex items-center">
                            <div class="p-2 rounded-full bg-yellow-100 text-yellow-800 mr-3"><i class="fas fa-list"></i></div>
                            <div>
                                <div class="font-medium">Переключить на Список</div>
                                <div class="text-xs text-[var(--tg-theme-hint-color)]">Простой список задач</div>
                            </div>
                        </div>
                    </div>
                    <div class="command-option px-4 py-3 hover:bg-[var(--tg-theme-secondary-bg-color)] cursor-pointer">
                        <div class="flex items-center">
                            <div class="p-2 rounded-full bg-indigo-100 text-indigo-800 mr-3"><i class="fas fa-columns"></i></div>
                            <div>
                                <div class="font-medium">Переключить на Доску</div>
                                <div class="text-xs text-[var(--tg-theme-hint-color)]">Канбан-управление задачами</div>
                            </div>
                        </div>
                    </div>
                    <div class="command-option px-4 py-3 hover:bg-[var(--tg-theme-secondary-bg-color)] cursor-pointer">
                        <div class="flex items-center">
                            <div class="p-2 rounded-full bg-red-100 text-red-800 mr-3"><i class="fas fa-calendar-alt"></i></div>
                            <div>
                                <div class="font-medium">Переключить на Календарь</div>
                                <div class="text-xs text-[var(--tg-theme-hint-color)]">Задачи на календаре</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-2 text-xs text-center text-[var(--tg-theme-hint-color)] border-t border-[var(--tg-theme-secondary-bg-color)]">
                    Нажмите Esc, чтобы закрыть
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div id="empty-state" class="hidden flex flex-col items-center justify-center py-12">
        <div class="w-24 h-24 bg-[var(--tg-theme-secondary-bg-color)] rounded-full flex items-center justify-center mb-4">
            <i class="fas fa-tasks text-3xl text-[var(--tg-theme-hint-color)]"></i>
        </div>
        <h3 class="text-lg font-medium mb-2">Пока нет задач</h3>
        <p class="text-sm text-[var(--tg-theme-hint-color)] mb-4 text-center max-w-md px-4">Начните с создания первой задачи. Нажмите «+» или клавишу «N» на клавиатуре.</p>
        <button id="empty-state-add-task" class="px-4 py-2 rounded-lg bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)]">Добавить задачу</button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Telegram WebApp / тема
    const tg = window.Telegram ? window.Telegram.WebApp : null;
    if (tg && tg.colorScheme === 'dark') {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
    tg && tg.expand();

    const user = tg?.initDataUnsafe?.user;
    if (user) {
        console.log('User ID:', user.id, 'Name:', user.first_name, user.last_name || '');
    }

    // Представления
    const viewContents = document.querySelectorAll('.view-content');
    const viewSelectors = document.querySelectorAll('.view-selector');
    let currentView = 'list';

    function showView(view){
        viewContents.forEach(content => {
            content.classList.add('hidden');
            if (content.id === `${view}-view`) content.classList.remove('hidden');
        });
        viewSelectors.forEach(btn => {
            btn.classList.remove('bg-[var(--tg-theme-button-color)]', 'text-[var(--tg-theme-button-text-color)]');
            if (btn.dataset.view === view) {
                btn.classList.add('bg-[var(--tg-theme-button-color)]', 'text-[var(--tg-theme-button-text-color)]');
            }
        });
        currentView = view;
    }
    viewSelectors.forEach(btn => btn.addEventListener('click', () => showView(btn.dataset.view)));
    showView('list'); // по умолчанию

    // Модалка задачи
    const taskModal = document.getElementById('task-modal');
    const addTaskButtons = document.querySelectorAll('#add-task-button, #mobile-add-task-button, #empty-state-add-task');
    const closeTaskModalBtn = document.getElementById('close-task-modal');
    const cancelTaskBtn = document.getElementById('cancel-task');

    function openTaskModal(){ taskModal.classList.remove('hidden'); }
    function closeTaskModal(){ taskModal.classList.add('hidden'); }

    addTaskButtons.forEach(b => b.addEventListener('click', openTaskModal));
    closeTaskModalBtn.addEventListener('click', closeTaskModal);
    cancelTaskBtn.addEventListener('click', closeTaskModal);

    // Модалка проекта
    const projectModal = document.getElementById('project-modal');
    const addProjectButton = document.getElementById('add-project-button');
    const closeProjectModalBtn = document.getElementById('close-project-modal');
    const cancelProjectBtn = document.getElementById('cancel-project');

    function openProjectModal(){ projectModal.classList.remove('hidden'); }
    function closeProjectModal(){ projectModal.classList.add('hidden'); }

    addProjectButton.addEventListener('click', openProjectModal);
    closeProjectModalBtn.addEventListener('click', closeProjectModal);
    cancelProjectBtn.addEventListener('click', closeProjectModal);

    // Палитра команд
    const commandPalette = document.getElementById('command-palette');
    const commandInput = document.getElementById('command-input');
    const commandOptions = document.querySelectorAll('.command-option');

    function openCommandPalette(){
        commandPalette.classList.remove('hidden');
        commandInput.value = '';
        setTimeout(() => commandInput.focus(), 0);
    }
    function closeCommandPalette(){
        commandPalette.classList.add('hidden');
    }
    document.addEventListener('keydown', (e) => {
        const inInput = ['INPUT','TEXTAREA'].includes(document.activeElement.tagName);
        if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'k') {
            e.preventDefault();
            openCommandPalette();
        }
        if (!inInput && e.key.toLowerCase() === 'n' && !e.metaKey && !e.ctrlKey && !e.altKey){
            e.preventDefault();
            openTaskModal();
        }
        if (e.key === 'Escape'){
            if (!commandPalette.classList.contains('hidden')) closeCommandPalette();
            else if (!taskModal.classList.contains('hidden')) closeTaskModal();
            else if (!projectModal.classList.contains('hidden')) closeProjectModal();
        }
    });
    commandPalette.addEventListener('click', (e) => { if (e.target === commandPalette) closeCommandPalette(); });
    commandOptions.forEach(option => {
        option.addEventListener('click', () => {
            const action = option.querySelector('.font-medium').textContent.trim();
            console.log('Выбрано:', action);
            closeCommandPalette();
            if (action.includes('Создать новую задачу')) openTaskModal();
            else if (action.includes('Искать задачи')) document.getElementById('search-button').click();
            else if (action.includes('Создать новый проект')) openProjectModal();
            else if (action.includes('Список')) showView('list');
            else if (action.includes('Доску')) showView('kanban');
            else if (action.includes('Календарь')) showView('calendar');
        });
    });

    // Сохранение задачи / проекта (демо-логика)
    const saveTaskBtn = document.getElementById('save-task');
    const saveProjectBtn = document.getElementById('save-project');

    saveTaskBtn.addEventListener('click', () => {
        const title = document.getElementById('task-title').value.trim();
        const priority = document.getElementById('task-priority').value;
        const status = document.getElementById('task-status').value;
        const project = document.getElementById('task-project').value;
        const dueDate = document.getElementById('task-due-date').value;
        const description = document.getElementById('task-description').value.trim();
        const reminder = document.getElementById('task-reminder').value;

        console.log('Задача сохранена:', { title, priority, status, project, dueDate, description, reminder });
        closeTaskModal();
        document.getElementById('empty-state').classList.add('hidden');
        // Здесь можно повесить сохранение в IndexedDB/Firebase/бот и т.д.
    });

    saveProjectBtn.addEventListener('click', () => {
        const name = document.getElementById('project-name').value.trim();
        const description = document.getElementById('project-description').value.trim();
        console.log('Проект сохранён:', { name, description });
        closeProjectModal();
        if (name) {
            const projectSelector = document.getElementById('project-selector');
            const option = document.createElement('option');
            option.value = name.toLowerCase();
            option.textContent = name;
            projectSelector.appendChild(option);
        }
    });

    // Отмечание выполнения задачи (перечёркивание)
    document.querySelectorAll('.task-card input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', function(){
            const card = this.closest('.task-card');
            const title = card.querySelector('h3');
            if (this.checked){
                card.classList.add('opacity-70');
                title && title.classList.add('line-through');
            } else {
                card.classList.remove('opacity-70');
                title && title.classList.remove('line-through');
            }
        });
    });

    // Подзадачи — визуальный тоггл
    document.querySelectorAll('.subtask-checkbox').forEach(cb => {
        cb.addEventListener('change', function(){
            const label = this.nextElementSibling;
            label && label.classList.toggle('line-through', this.checked);
        });
    });

    // Календарь: клик по дню — открыть модалку и проставить дату (пример: июнь 2023)
    document.querySelectorAll('.calendar-day').forEach(day => {
        day.addEventListener('click', function(){
            const numberEl = this.querySelector('.text-right');
            if (!numberEl) return;
            const dayNum = numberEl.textContent.trim().padStart(2, '0');
            document.getElementById('task-due-date').value = `2023-06-${dayNum}`;
            openTaskModal();
        });
    });

    // Навигация календаря (заглушки)
    document.getElementById('prev-month').addEventListener('click', () => console.log('Предыдущий месяц'));
    document.getElementById('next-month').addEventListener('click', () => console.log('Следующий месяц'));
    document.getElementById('today-button').addEventListener('click', () => console.log('К сегодняшнему дню'));

    // Drag & Drop (упрощённо)
    const kanbanCards = document.querySelectorAll('.kanban-column .task-card');
    kanbanCards.forEach(card => {
        card.setAttribute('draggable', 'true');
        card.addEventListener('dragstart', () => card.classList.add('opacity-50'));
        card.addEventListener('dragend', () => card.classList.remove('opacity-50'));
    });
    document.querySelectorAll('.kanban-column').forEach(column => {
        column.addEventListener('dragover', (e) => { e.preventDefault(); column.classList.add('bg-opacity-50'); });
        column.addEventListener('dragleave', () => column.classList.remove('bg-opacity-50'));
        column.addEventListener('drop', (e) => {
            e.preventDefault();
            column.classList.remove('bg-opacity-50');
            const dragged = document.querySelector('.task-card.opacity-50');
            if (!dragged) return;
            const list = column.querySelector('.space-y-3') || column;
            list.appendChild(dragged);

            let newStatus = 'backlog';
            const title = column.querySelector('h3')?.textContent || '';
            if (title.includes('В работе')) newStatus = 'in-progress';
            else if (title.includes('На проверке')) newStatus = 'review';
            else if (title.includes('Готово')) newStatus = 'done';
            console.log('Задача перемещена, новый статус:', newStatus);
        });
    });
});
</script>
</body>
</html>
